<meta charset='utf-8'>
<!--
file:///home/ywsing/suite/src/main/html/render.html
-->
<!DOCTYPE html>
<html>
	<body>
		<div id='target'></div>
	</body>

	<script src='frp.js'></script>
	<script src='fun.js'></script>
	<script src='render.js'></script>

	<script type='text/javascript'>
'use strict';
let { lens, range, read, } = fun();
let { rd, renderAgain, } = render();
let close;

let dragsource = null;
let dragtarget = null;

let handle = (vm, ev) => {
	// ev.preventDefault();
	console.log(vm, ev.type, ev);
};

let handledragend = (vm, ev) => {
	dragtarget.d = dragsource.d;
	dragsource.d = 0;
	handle(vm, ev);
	renderAgain(view, vm => JSON.parse(JSON.stringify(vm)));
};

let handledragenter = (vm, ev) => handle(dragtarget = vm, ev);
let handledragstart = (vm, ev) => handle(dragsource = vm, ev);

let viewCell = rd.parse(`
	<div draggable='true'
		style='
			background: { vm.d ? "#888888" : "#DDDDDD" };
			display: table-cell;
			height: 50px;
			text-align: center;
			vertical-align: middle;
			width: 50px;
		'
		rd_on_dragend='handledragend(vm, ev)'
		rd_on_dragenter='handledragenter(vm, ev)'
		rd_on_dragexit='handle(vm, ev)'
		rd_on_dragleave='handle(vm, ev)'
		rd_on_dragover='{}'
		rd_on_dragstart='handledragstart(vm, ev)'
		rd_on_drop='handle(vm, ev)'>
		<rd_if v='vm.d'>ðŸ˜‚</rd_if>
	</div>
`);

let view = rd.parse(`
	<span>
		<table style='font-family: monospace; font-size: 20; user-select: none;'>
			<rd_for>
				<tr>
					<rd_for>
						<td>
							<rd_component v='viewCell' />
						</td>
					</rd_for>
				</tr>
			</rd_for>
		</table>
		<button rd_on_click='close()'>Close</button>
	</span>
`);

var vm0 = range(0, 8).map(i => range(0, 8).map(j => ({ d: 0 })).list()).list();
vm0[1][1].d = 1;

// let interval = setInterval(() => renderAgain(view, vm => { vm[1][1].d = 1 - vm[1][1].d; return JSON.parse(JSON.stringify(vm)); }), 500);

renderAgain(view, vm => vm0);

close = () => {
	// clearInterval(interval);
	renderAgain(view, vm => null);
};

	</script>
</html>
