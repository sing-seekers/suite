<meta charset='utf-8'>
<!--
file:///home/ywsing/suite/src/main/html/render.html
-->
<!DOCTYPE html>
<html>
	<body>
		<div id='target'></div>
	</body>

	<script src='frp.js'></script>
	<script src='fun.js'></script>
	<script src='render.js'></script>

	<script type='text/javascript'>
'use strict';
let { lens, range, read, } = fun();
let { rd, renderAgain, } = render();
let close;

let dragsource = null;
let dragtarget = null;

let handle = (vm, ev) => {
	// ev.preventDefault();
	console.log(vm, ev.type, ev);
};

let handledragend = (vm, ev) => {
	dragtarget.d = dragsource.d;
	dragsource.d = 0;
	handle(vm, ev);
	renderAgain(rd_vm, vm => JSON.parse(JSON.stringify(vm)));
};

let handledragenter = (vm, ev) => {
	handle(dragtarget = vm, ev);
};

let handledragstart = (vm, ev) => {
	handle(dragsource = vm, ev);
};

let rd_vm = rd.parse(`
	<span>
		<table style='user-select: none;'>
			<rd_for>
				<tr>
					<rd_for>
						<td>
							<div draggable='true'
								style='background: { vm.d ? "#888888" : "#DDDDDD" }; height: 50px; width: 50px;'
								rd_on_dragend='handledragend(vm, ev)'
								rd_on_dragenter='handledragenter(vm, ev)'
								rd_on_dragexit='handle(vm, ev)'
								rd_on_dragleave='handle(vm, ev)'
								rd_on_dragover='{}'
								rd_on_dragstart='handledragstart(vm, ev)'
								rd_on_drop='handle(vm, ev)'>
								<!--rd_if>D</rd_if-->
							</div>
						</td>
					</rd_for>
				</tr>
			</rd_for>
		</table>
		<button rd_on_click='close()'>Close</button>
	</span>
`);

var vm0 = range(0, 3).map(i => range(0, 3).map(j => ({ d: 0 })).list()).list();
vm0[1][1] = { d: 1 };

// let interval = setInterval(() => renderAgain(rd_vm, vm => { vm[1][1].d = 1 - vm[1][1].d; return JSON.parse(JSON.stringify(vm)); }), 500);

renderAgain(rd_vm, vm => vm0);

close = () => {
	// clearInterval(interval);
	renderAgain(rd_vm, vm => null);
};

	</script>
</html>
