<meta charset='utf-8'>
<!--
file:///home/ywsing/suite/src/main/html/five-in-a-row-hex-rects.html
-->
<!DOCTYPE html>
<html>
	<head>
		<title>0 - Five in a row</title>
		<meta name='viewport' content='width=device-width, initial-scale=1.0'>
		<link href='https://fonts.googleapis.com/css?family=Oswald:200&display=swap' rel='stylesheet'>
	</head>
	<body>
		<div id='target' style='display: flex; justify-content: center;'></div>
	</body>

	<script src='eval-script.js'></script>
	<script src='five-in-a-row.js'></script>
	<script src='frp.js'></script>
	<script src='pq.js'></script>

	<script type='text/javascript'>
'use strict';

let eatdirs = [[0, -1], [-1, 0], [-1, +1],];
let movedirs = [[-1, 0], [+1, 0], [0, -1], [0, +1], [-1, +1,], [+1, -1,],];

const usp = new URLSearchParams(window.location.search);
const colorsp = usp.get('colors');
const sizep = usp.get('size');

let size = sizep != null ? +sizep : 7;
let nStoneTypes = colorsp != null ? +colorsp : 5;

let cc = ((sizex, sizey) => {
	let startx = 0, endx = startx + sizex;

	let yrange = x => {
		let o = x >> 1;
		return { starty: -o, endy: sizey - o, };
	};

	return {
		area: sizex * sizey,
		arrayx: () => ({
			indices: range(startx, endx).list(),
			length: endx,
		}),
		arrayy: x => {
			let { starty, endy, } = yrange(x);
			return { indices: range(starty, endy).list(), length: endy, };
		},
		back_xy: f => {
			for (let x = endx - 1; startx <= x; x--) {
				let { starty, endy, } = yrange(x);
				for (let y = endy - 1; starty <= y; y--) f(x, y);
			}
		},
		for_xy: f => {
			for (let x = startx; x < endx; x++) {
				let { starty, endy, } = yrange(x);
				for (let y = starty; y < endy; y++) f(x, y);
			}
		},
		inbounds: (x, y) => {
			let { starty, endy, } = yrange(x);
			return startx <= x && x < endx && starty <= y && y < endy;
		},
		random_xy: () => {
			let x = rand(startx, endx);
			let { starty, endy, } = yrange(x);
			return { x, y: rand(starty, endy), };
		},
	};
})(size, size);

Promise.resolve(true)
.then(() => evalscriptglobal('https://raw.githubusercontent.com/stupidsing/suite/master/src/main/html/fun.js', 'fun()'))
// .then(({ lens, range, read, }) => {
.then(() => evalscriptglobal('https://raw.githubusercontent.com/stupidsing/suite/master/src/main/html/render.js', 'render()'))
// .then(({ rd, renderAgain, }) => {
.then(() => {
let viewCell = rd.parse(`
	<span draggable='true'
		style='
			background: { vm.selected ? palette[2] : "#DDDDDD" };
			display: inline-block;
			filter___: { vm.selected ? "brightness(80%)" : "brightness(100%)" };
			font-size: 25px;
			height: 40px;
			margin: 2px 0px 2px 0px;
			text-align: center;
			vertical-align: middle;
			width: 40px;'
		rd_on_click='handleclick(vm, ev)'>
		<rd_map v='vm.d'>
			<rd_if v='vm != null'>{ icons[vm] }</rd_if>
		</rd_map>
	</span>
`, {});

let viewCells = rd.parse(`
	<rd_for>
		<rd_component v='views.viewCell' />
	</rd_for>
`, { viewCell, });

globalThis.view = rd.parse(`
	<span style='display: flex; flex-direction: column;'>
		<span style='align-items: center; display: flex; justify-content: space-between;'>
			<span>
				<rd_map v='vm.nextstones'>
					<rd_component v='views.viewCells' />
				</rd_map>
			</span>
			<span style='color: { palette[4] }; font-family: Oswald, monospace; margin-right: 16px;'>{ vm.score }</span>
		</span>
		<p/>
		<rd_map v='vm.board'>
			<rd_for>
				<rd_map v='vm.indices.map(i => vm[i])'>
					<div>
						<span style='
							display: inline-block;
							font-size: 25px;
							height: 40px;
							margin: 2px 0px 2px 0px;
							text-align: center;
							vertical-align: middle;
							width: { vm[0].x * 18 + vm[0].y * 36 }px;'>
						</span>
						<rd_component v='views.viewCells' />
					</div>
				</rd_map>
			</rd_for>
		</rd_map>
		<!-- button rd_on_click='handleclose()'>close</button -->
		<rd_map v='vm.notification'>
			<div style='background: { palette[vm.c] }; bottom: 0; font-family: Oswald, monospace; left: 0; position: fixed; text-align: center; width: 100%;'>
				<p>{ vm.message }</p>
			</div>
		</rd_map>
	</span>
`, { viewCells, });

vw.init();
});
	</script>
</html>
